name: Quality Assurance
on: [pull_request, workflow_call]

jobs:
    quality-assurance:
      name: Quality Assurance
      runs-on: ubuntu-latest
      container: python:3.11.4-buster
      services:
        db:
          image: postgres:15.4-alpine
          env:
            POSTGRES_DB: localhost
            POSTGRES_USER: localhost
            POSTGRES_PASSWORD: localhost

      steps:

        - uses: actions/checkout@v2
        - name: Create .env
          run: |
            ls -la
            echo "DJANGO_SECRET_KEY=django-insecure-(_f-p(nl=#ex$sjj8re!!+kgj)93!nldy69k1$7j-t!$%ap*^l
            POSTGRES_DB=localhost
            POSTGRES_USER=localhost
            POSTGRES_PASSWORD=localhost            
            DJANGO_DATABASE_HOST=db
            DJANGO_DATABASE_PORT=5432
            " > my_burgo_backend/config/.env
            cat my_burgo_backend/config/.env

        - name: Install Poetry
          uses: abatilo/actions-poetry@v2.0.0
          with:
            poetry-version: 1.4.2

        - name: Git Config
          run: git config --global --add safe.directory '*'

        - name: Install Dependencies
          run: make install
#
#        - name: Lint
#          run: make lint